<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.99.1"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../favicons/favicon.ico><link rel=apple-touch-icon href=../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../favicons/android-192x192.png sizes=192x192><title>Creating a Vertica image |</title><meta name=description content="Vertica on Kubernetes deploys an Eon Mode database in a Kubernetes StatefulSet. The Vertica server image is optimized for Kubernetes, using the minimum tools and libraries requried to containerize Vertica.
This tutorial describes the components of our minimal Vertica image so you can build a custom Vertica image for development or production purposes. The Dockerfile reduces image size with a multistage build, and orders instructions for the most efficient cache and build."><meta property="og:title" content="Creating a Vertica image"><meta property="og:description" content="Vertica on Kubernetes deploys an Eon Mode database in a Kubernetes StatefulSet. The Vertica server image is optimized for Kubernetes, using the minimum tools and libraries requried to containerize Vertica.
This tutorial describes the components of our minimal Vertica image so you can build a custom Vertica image for development or production purposes. The Dockerfile reduces image size with a multistage build, and orders instructions for the most efficient cache and build."><meta property="og:type" content="article"><meta property="og:url" content="/containers/creating-image/"><meta property="article:section" content="containers"><meta itemprop=name content="Creating a Vertica image"><meta itemprop=description content="Vertica on Kubernetes deploys an Eon Mode database in a Kubernetes StatefulSet. The Vertica server image is optimized for Kubernetes, using the minimum tools and libraries requried to containerize Vertica.
This tutorial describes the components of our minimal Vertica image so you can build a custom Vertica image for development or production purposes. The Dockerfile reduces image size with a multistage build, and orders instructions for the most efficient cache and build."><meta itemprop=wordCount content="2788"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating a Vertica image"><meta name=twitter:description content="Vertica on Kubernetes deploys an Eon Mode database in a Kubernetes StatefulSet. The Vertica server image is optimized for Kubernetes, using the minimum tools and libraries requried to containerize Vertica.
This tutorial describes the components of our minimal Vertica image so you can build a custom Vertica image for development or production purposes. The Dockerfile reduces image size with a multistage build, and orders instructions for the most efficient cache and build."><link rel=preload href=../../scss/main.min.8a6ed667b3d1bd12fba7ff44e1fe8c839f35d62b1dd330530f402a195a4dac52.css as=style><link href=../../scss/main.min.8a6ed667b3d1bd12fba7ff44e1fe8c839f35d62b1dd330530f402a195a4dac52.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<link rel=stylesheet href=../../css/prism.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=../../><span class="navbar-brand__logo navbar-logo"><svg width="398" height="142" viewBox="0 0 398 142" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMinYMin"><title>Vertica-OT-White</title><g id="Outlined" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Logos---Outlined-(Dark-Bg)" transform="translate(-970.000000, -645.000000)" fill="#fff" fill-rule="nonzero"><path d="M979.5728 750.5824H982.9136V760.912C983.7328 759.8368 984.68 759.0048 985.7552 758.416 986.8304 757.8272 988.0976 757.5328 989.5568 757.5328 990.9648 757.5328 992.2 757.7888 993.2624 758.3008 994.3248 758.8128 995.208 759.5296 995.912 760.4512 996.616 761.3728 997.1408 762.4672 997.4864 763.7344S998.0048 766.4032 998.0048 767.9392C998.0048 769.5776 997.8 771.056 997.3904 772.3744S996.392 774.8128 995.624 775.7344C994.856 776.656 993.928 777.3664 992.84 777.8656 991.752 778.3648 990.5296 778.6144 989.1728 778.6144 988.0208 778.6144 986.9008 778.3776 985.8128 777.904 984.7248 777.4304 983.7456 776.6176 982.8752 775.4656V778H979.5728V750.5824zM982.8752 768.6304C982.8752 769.9104 983.0224 771.0048 983.3168 771.9136 983.6112 772.8224 984.0144 773.5712 984.5264 774.16 985.0384 774.7488 985.6528 775.1776 986.3696 775.4464 987.0864 775.7152 987.8672 775.8496 988.712 775.8496 989.5312 775.8496 990.2928 775.7088 990.9968 775.4272S992.3088 774.6912 992.8208 774.064C993.3328 773.4368 993.736 772.624 994.0304 771.6256 994.3248 770.6272 994.472 769.4112 994.472 767.9776 994.472 766.5184 994.312 765.296 993.992 764.3104 993.672 763.3248 993.256 762.5376 992.744 761.9488 992.232 761.36 991.6496 760.9376 990.9968 760.6816S989.672 760.2976 988.9808 760.2976C988.1104 760.2976 987.304 760.4448 986.5616 760.7392S985.1728 761.4688 984.6224 762.0448C984.072 762.6208 983.6432 763.3504 983.336 764.2336S982.8752 766.1344 982.8752 767.2864V768.6304zm19.5456 13.5936C1003.1376 782.48 1003.8544 782.608 1004.5712 782.608 1005.3904 782.608 1006.024 782.3968 1006.472 781.9744 1006.92 781.552 1007.3616 780.7648 1007.7968 779.6128L1008.6032 777.5008 1000.1936 758.1472H1004.072L1010.3312 773.7376 1016.0528 758.1472H1019.7392L1011.0608 779.8816C1010.7024 780.7776 1010.344 781.5648 1009.9856 782.2432 1009.6272 782.9216 1009.2304 783.504 1008.7952 783.9904S1007.8416 784.8416 1007.24 785.0848 1005.9024 785.4496 1005.032 785.4496C1004.4176 785.4496 1003.8672 785.4112 1003.3808 785.3344 1002.8944 785.2576 1002.3568 785.1168 1001.768 784.912L1002.4208 782.224zm68.6254-26.884714c5.90264000000002.0 10.10727 4.33928500000002 10.10727 12.133928C1081.15347 772.294643 1079.37459 779.848214 1070.72277 779.848214 1067.65017 779.848214 1065.22442 778.160714 1064.65842 777.196429V787H1057.5429V755.901786H1064.73927V757.991071C1065.38614 756.946429 1067.56931 755.339286 1071.0462 755.339286zm-28.13861.0C1052.77228 755.901786 1054.95545 763.294643 1054.95545 767.553571 1054.95545 773.5 1051.39769 779.928571 1042.01815 779.928571 1035.22607 779.928571 1029 776.232143 1029 767.553571 1029 760.401786 1033.68977 754.857143 1042.90759 755.339286zM1104.60231 758.392857C1107.75578 761.6875 1107.91749 766.267857 1107.99835 768.919643H1090.61386C1090.61386 771.8125 1092.31188 774.785714 1096.19307 774.785714S1101.44884 772.294643 1102.33828 770.6875L1107.67492 773.258929C1107.02805 774.625 1104.92574 779.928571 1095.62706 779.928571c-7.19637000000012.0-12.20957-4.25892800000008-12.20957-11.973214.0-5.625 2.91088999999988-12.616071 12.4521499999998-12.616071C1097.32508 755.339286 1101.44884 755.178571 1104.60231 758.392857zM1170.17822 758.3125C1173.33168 761.607143 1173.4934 766.1875 1173.57426 768.839286H1156.27063C1156.18977 771.732143 1157.72607 774.705357 1161.5264 774.705357 1165.40759 774.705357 1166.5396 772.214286 1167.42904 770.607143L1172.84653 773.258929 1171.47195 775.267857C1170.17822 777.035714 1167.83333 779.848214 1160.9604 779.848214 1153.76403 779.848214 1148.9934 775.589286 1148.9934 767.875 1148.9934 762.25 1151.90429 755.258929 1161.44554 755.258929L1161.67122 755.258217C1163.29153 755.251276 1167.17492 755.251276 1170.17822 758.3125zM1206.88779 751V755.982143H1211.57756V760.803571H1206.88779V771.169643C1206.80693 772.616071 1206.80693 773.821429 1208.74752 773.821429L1211.25413 773.741071V779.125C1209.79868 779.366071 1208.82838 779.526786 1207.53465 779.526786 1205.02805 779.526786 1202.35974 779.366071 1200.82343 777.196429 1199.85314 775.830357 1199.77228 774.142857 1199.77228 771.892857V760.723214H1195.40594L1198.64026 755.901786H1199.77228V751H1206.88779zM1143.17162 751V755.901786H1150.5297L1147.29538 760.723214H1143.09076v10.446429C1143.0099 772.616071 1143.0099 773.821429 1144.9505 773.821429L1147.4571 773.741071V779.125C1145.92079 779.366071 1145.03135 779.526786 1143.73762 779.526786 1141.31188 779.526786 1138.56271 779.366071 1137.0264 777.196429 1136.05611 775.830357 1135.97525 774.142857 1135.97525 771.892857V751H1143.17162zM1125.14026 755.339286C1126.59571 755.339286 1128.21287 755.580357 1129.42574 756.223214 1131.93234 757.508929 1132.66007 759.598214 1132.66007 763.294643V779.366071H1125.4637V766.107143C1125.4637 764.017857 1125.38284 763.214286 1125.14026 762.571429 1124.57426 761.285714 1123.36139 760.803571 1121.90594 760.803571 1118.50302 760.803571 1118.21341 763.224981 1118.18876 765.914004L1118.18676 766.290737 1118.18647 779.366071H1111.07096V755.901786H1118.26733V757.991071C1118.99505 757.267857 1119.39934 756.705357 1120.69307 756.142857 1121.82508 755.660714 1123.36139 755.339286 1125.14026 755.339286zM1180.28548 755.982143 1184.08581 761.205357 1187.56271 755.982143H1195.64851L1188.29043 767.071429 1197.18482 779.366071H1189.01815L1184.32838 772.857143 1180.0429 779.366071H1171.9571L1180.20462 767.071429 1172.19967 755.982143H1180.28548zM1041.533 760.883929C1039.59241 760.964286 1038.37954 761.607143 1037.40924 763.053571 1036.5198 764.339286 1036.19637 765.946429 1036.19637 767.553571 1036.19637 771.169643 1038.05611 774.464286 1042.01815 774.464286 1045.89934 774.464286 1047.75908 771.410714 1047.75908 767.875 1047.75908 765.303571 1047.11221 763.375 1045.73762 762.169643 1044.28218 760.883929 1042.58416 760.803571 1041.533 760.883929zM1069.59076 760.723214C1068.29703 760.723214 1066.92244 761.205357 1065.95215 762.491071 1064.90099 763.696429 1064.4967 765.544643 1064.4967 767.633929 1064.4967 770.366071 1065.30528 772.053571 1066.19472 773.017857 1067.0033 773.901786 1068.21617 774.464286 1069.42904 774.464286 1072.90594 774.464286 1074.44224 770.928571 1074.44224 767.473214 1074.44224 764.580357 1073.55281 761.526786 1070.64191 760.883929 1070.23762 760.803571 1069.91419 760.723214 1069.59076 760.723214zM1095.70792 760C1094.0099 760 1092.79703 760.803571 1092.06931 761.526786 1091.09901 762.571429 1090.85644 763.616071 1090.61386 764.660714L1100.55941 764.580357C1100.39769 763.616071 1100.23597 762.25 1099.18482 761.285714 1098.29538 760.401786 1096.92079 760 1095.70792 760zM1161.36469 760C1159.66667 760 1158.4538 760.803571 1157.72607 761.526786 1156.75578 762.571429 1156.5132 763.616071 1156.27063 764.660714L1166.21617 764.580357C1166.05446 763.616071 1165.89274 762.25 1164.84158 761.285714 1163.95215 760.401786 1162.57756 760 1161.36469 760zM1221.28053 755.982143 1222.4934 759.839286 1223.70627 755.982143H1224.91914V760.803571H1224.11056V757.830357L1224.19142 756.866071 1223.94884 757.669643 1222.89769 760.883929H1222.08911L1221.03795 757.669643 1220.79538 756.866071 1220.87624 757.830357V760.803571H1220.06766V755.982143H1221.28053zM1219.66337 755.901786V756.625H1218.0462V760.803571H1217.23762V756.625H1215.62046V755.901786H1219.66337zM983.707685 647.665636 1012.49328 698.718315l28.88386-51.052679H1092.69771V659.626331h-44.32753L1012.58608 723 970 647.665636h13.707685zm108.992755 30.353198v11.960695H1053.70641v17.747247H1092.70044v11.960696H1041.74562V678.018834H1092.70044zM1218.81169 719.684742h11.95533V647.663998h-11.95533v72.020744zm-82.14076-72.016377C1148.0749 647.668365 1157.27341 656.8668 1157.27341 668.270676 1157.27341 676.824948 1151.93991 684.276499 1144.3955 687.31171L1162.05554 719.689109h-11.95533L1133.26448 688.780184h-23.6377V719.689109h-11.95533V647.668365zM1214.11799 647.666181V659.621418H1189.55771v60.065508h-11.95533V659.621418H1161.31802C1159.66393 654.932126 1156.8143 650.886998 1153.04209 647.851788V647.666181H1214.11799zm-77.44706 11.95742H1109.62678V676.917751H1136.67093C1141.45307 676.917751 1145.31808 673.05277 1145.31808 668.270676S1141.45307 659.623601 1136.67093 659.623601zm186.44473-14.624693L1292.3921 696.138932V696.231735C1288.06853 703.404877 1280.25116 708.19243 1271.33107 708.19243 1257.71618 708.19243 1246.67798 697.154308 1246.67798 683.539532c0-13.614775 11.0382-24.6528970000001 24.65309-24.6528970000001C1279.6998 658.886635 1287.0586 663.024566 1291.56778 669.4662L1298.00401 658.706487C1291.38217 651.527886 1281.90525 647.117005 1271.33107 647.117005 1251.18716 647.117005 1234.9028 663.395778 1234.9028 683.539532 1234.9028 703.683286 1251.18716 719.96206 1271.33107 719.96206 1284.57473 719.96206 1296.1643 712.881721 1302.60599 702.302156L1323.11566 668.08507 1354.20497 719.869257 1368 719.689109 1323.11566 644.998908z" id="Vertica-OT-White"/></g></g></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.vertica.com/docs/latest/HTML/Content/Home.htm target=_blank><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.vertica.com/knowledgebase/ target=_blank><span>Knowledge Base</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://academy.vertica.com/ target=_blank><span>Academy</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://forum.vertica.com/ target=_blank><span>Forum</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.microfocus.com/en-us/support/Vertica%20Analytics%20Platform target=_blank><span>Support</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=../../ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Vertica Integrator's Guide</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-server-installation-li><input type=checkbox id=m-server-installation-check>
<label for=m-server-installation-check><a href=../../server-installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-server-installation><span>Server installation and configuration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-containers-li><input type=checkbox id=m-containers-check checked>
<label for=m-containers-check><a href=../../containers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-containers><span>Containerized Vertica</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-containerscreating-image-li><input type=checkbox id=m-containerscreating-image-check checked>
<label for=m-containerscreating-image-check><a href=../../containers/creating-image/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-containerscreating-image><span class=td-sidebar-nav-active-item id=td-sidebar-nav-active-item>Creating a Vertica image</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containersk8s-dev-env-li><input type=checkbox id=m-containersk8s-dev-env-check>
<label for=m-containersk8s-dev-env-check><a href=../../containers/k8s-dev-env/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containersk8s-dev-env><span>Vertica on Kubernetes development environment</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containersprometheus-metrics-blog-li><input type=checkbox id=m-containersprometheus-metrics-blog-check>
<label for=m-containersprometheus-metrics-blog-check><a href=../../containers/prometheus-metrics-blog/ title="Scraping metrics with Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containersprometheus-metrics-blog><span>Scraping Prometheus metrics</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containersvcluster-ops-li><input type=checkbox id=m-containersvcluster-ops-check>
<label for=m-containersvcluster-ops-check><a href=../../containers/vcluster-ops/ title="Client access with VClusterOps " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containersvcluster-ops><span>VClusterOps access</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-data-protocols-formats-li><input type=checkbox id=m-data-protocols-formats-check>
<label for=m-data-protocols-formats-check><a href=../../data-protocols-formats/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-data-protocols-formats><span>Data protocols and formats</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-cli-args-li><input type=checkbox id=m-cli-args-check>
<label for=m-cli-args-check><a href=../../cli-args/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-cli-args><span>Command line arguments</span></a></label></li></ul></li></ul></nav></div><script>var myElement=document.getElementById("td-sidebar-nav-active-item");myElement.scrollIntoView({behavior:"auto",block:"center",inline:"start"})</script></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#security-considerations>Security Considerations</a></li><li><a href=#building>Building</a></li><li><a href=#dockerfile-specifics>Dockerfile Specifics</a><ul><li><a href=#multistage-build>Multistage Build</a></li><li><a href=#setting-global-arg-variables>Setting Global ARG Variables</a></li><li><a href=#first-stage>First Stage</a><ul><li><a href=#setting-arg-variables>Setting ARG Variables</a></li><li><a href=#adding-files>Adding Files</a></li><li><a href=#installing-dependencies>Installing Dependencies</a></li><li><a href=#prepare-the-static-ssh-keys>Prepare the static ssh keys</a></li><li><a href=#configure-container-network-and-access-privileges>Configure Container Network and Access Privileges</a></li></ul></li><li><a href=#second-stage>Second Stage</a><ul><li><a href=#choosing-your-operating-system>Choosing Your Operating System</a></li></ul></li><li><a href=#third-stage>Third Stage</a><ul><li><a href=#set-up-stage>Set Up Stage</a></li><li><a href=#additional-arg-variables>Additional ARG Variables</a></li><li><a href=#copy-artifacts-from-the-first-stage>COPY Artifacts from the First Stage</a></li><li><a href=#setting-environment-variables>Setting Environment Variables</a></li><li><a href=#install-daemon-scripts>Install Daemon Scripts</a></li><li><a href=#install-init-program>Install init program</a></li><li><a href=#installing-dependencies-1>Installing Dependencies</a></li></ul></li><li><a href=#the-entrypoint-script>The Entrypoint Script</a></li><li><a href=#exposing-ports>Exposing Ports</a></li><li><a href=#configuring-image-access>Configuring Image Access</a></li><li><a href=#adding-labels-to-the-image>Adding Labels to the Image</a></li></ul></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../containers/>Containerized Vertica</a></li><li class="breadcrumb-item active" aria-current=page><a href=../../containers/creating-image/ aria-disabled=true class="btn-link disabled">Creating a Vertica image</a></li></ol></nav><div class=td-content><h1>Creating a Vertica image</h1><header class=article-meta></header><p><a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/Containers/Kubernetes/ContainerizedVerticaWithK8s.htm>Vertica on Kubernetes</a> deploys an <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/Eon/EonOverview.htm>Eon Mode database</a> in a Kubernetes StatefulSet. The <a href=https://hub.docker.com/r/vertica/vertica-k8s>Vertica server image</a> is optimized for Kubernetes, using the minimum tools and libraries requried to containerize Vertica.</p><p>This tutorial describes the components of our minimal Vertica image so you can build a custom Vertica image for development or production purposes. The Dockerfile reduces image size with a multistage build, and orders instructions for the most efficient cache and build.</p><p>For additional guidance, refer to the <a href=https://github.com/vertica/vertica-kubernetes/blob/main/docker-vertica/Dockerfile>Dockerfile</a> hosted in the <a href=https://github.com/vertica/vertica-kubernetes>vertica-kubernetes GitHub repository</a>.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Physical or virtual machine running x86 Linux</li><li><a href=https://docs.docker.com/engine/install/>Docker engine</a></li><li><a href=https://www.gnu.org/software/make/><code>make</code> build tool</a></li><li>Vertica 11.0.1 or higher RPM</li><li>Local clone of the <a href=https://github.com/vertica/vertica-kubernetes>vertica-kubernetes GitHub
repository</a></li></ul><p>To build a container image with the GitHub repo, you must store the Vertica RPM in your local clone repo, in the <code>docker-vertica/packages</code> directory, with the name <code>vertica-x86_64.RHEL6.latest.rpm</code>.</p><h2 id=security-considerations>Security Considerations</h2><p>Vertica recommends the following open-source security scanners to protect against malware, and identify critical vulnerabilities that prevent unauthorized users from accessing sensitive information in your container runtime:</p><ul><li><a href=https://engine.anchore.io/docs/quickstart/>Anchore Engine</a>: A static analysis and policy-based compliance tool that evaluates images with user-defined security policies. Anchore identifies vulnerabilities and returns links to associated <a href=https://www.nist.gov/>NIST</a> reports.</li><li><a href=https://aquasecurity.github.io/trivy/latest/>Trivy</a>: A vulnerability scanner that you can add to your continuous integration (CI) toolchain.</li></ul><p>For additional container file guidance, refer to <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>Best practices for writing Dockerfiles</a>.</p><h2 id=building>Building</h2><p>The command to build the image is a <code>Makefile</code> target in the GitHub repository. Use the following command to initiate the build:</p><pre tabindex=0><code>$ make docker-build-vertica VERTICA_IMG=&lt;name of image&gt; MINIMAL_VERTICA_IMG=&lt;YES|NO&gt;
</code></pre><p>Explanation and rationale about the contents of the Dockerfile is in the subsequent section.</p><h2 id=dockerfile-specifics>Dockerfile Specifics</h2><h3 id=multistage-build>Multistage Build</h3><p>Vertica uses a multistage build to reduce the size of the final Docker image. Each <code>RUN</code> command adds a new layer to the Docker image. Each layer performs work using the previous layer, resulting in leftover build artifacts that increase the image size. Using a multistage build takes the final result of the first stage and use it as a single layer in the second stage, removing any unnecessary artifacts created by intermediary layers during any previous stages.</p><h3 id=setting-global-arg-variables>Setting Global ARG Variables</h3><p>Before the build stages begin, we must define ARG variables that are scoped globally across the two stages. To make an ARG variable available in a particular stage, you must define it after the FROM tag.</p><p>The Vertica image uses two different operating systems during the entire build process:</p><ul><li><a href=https://hub.docker.com/_/centos>CentOS 7</a> as the base image for the <strong>builder</strong> stage</li><li><a href=https://hub.docker.com/_/ubuntu>Ubuntu</a> as the base image for the
final image
Assign your operating system selection to the <code>BUILD_OS_VERSION</code> or <code>BASE_OS_VERSION</code> variables:</li></ul><pre tabindex=0><code>ARG BASE_OS_VERSION=&#34;lunar&#34;
ARG BUILDER_OS_VERSION=&#34;stream8&#34;
</code></pre><p>Both versions that you select must correspond to a docker tag for the OS images. If a tag is one that is overridden then you must do a <code>docker pull</code> prior to building the image so that you use the latest one.</p><p>When the <code>MINIMAL</code> argument is set to <code>YES</code>, the Dockerfile builds a smaller image. The smaller image omits large packages like Tensorflow and the Java runtime, which is required only to run Java UDx&rsquo;s. This will result in over 300MB (uncompressed) of savings. By default, we build the full image.</p><pre tabindex=0><code>ARG MINIMAL=&#34;&#34;
</code></pre><p>The <code>NO_KEYS</code> argument is optional. In some circumstances, you might want to manage the SSH keys that authenticate connections to the Vertica server container. When you set this argument to <code>YES</code>, the Dockerfile requires user-provided SSH keys:</p><pre tabindex=0><code>ARG NO_KEYS=&#34;&#34;
</code></pre><p>We use <a href=https://github.com/just-containers/s6-overlay>s6</a> as the init program. This argument allows you to choose the version of that program. This version refers to one of the GitHub releases on the s6 <a href=https://github.com/just-containers/s6-overlay>GitHub repository</a>.</p><pre tabindex=0><code>ARG S6_OVERLAY_VERSION=3.1.2.1
</code></pre><h3 id=first-stage>First Stage</h3><p>The first stage is named <strong>builder</strong>. The <strong>builder</strong> stage generates the /opt/vertica directory structure by downloading the required packages and dependencies, then running the Vertica installer. The <code>FROM</code> command sets the base image for the <strong>builder</strong> and initiates the build of that stage. The <code>BUILDER_OS_VERSION</code> was previously selected as the image version to use for this stage. The following <code>FROM</code> command assigns the name <strong>builder</strong> to the first stage in the multistage build:</p><pre tabindex=0><code>FROM quay.io/centos/centos:${BUILDER_OS_VERSION} as builder
</code></pre><h4 id=setting-arg-variables>Setting ARG Variables</h4><p>Container files use the <code>ARG</code> instruction to define build process variables. <strong>VERTICA_RPM</strong> stores the name of the Vertica RPM file. You must store the RPM in the <code>/packages</code> directory to build a container image. If you do not have a Vertica license, use the free trial <a href=https://www.vertica.com/register/>Community Edition</a> RPM.</p><pre tabindex=0><code>ARG VERTICA_RPM=&#34;vertica-x86_64.RHEL6.latest.rpm&#34;
</code></pre><p>The <code>MINIMAL</code> and <code>NO_KEYS</code> arguments are already globally defined&ndash;the following lines makes them available in this stage:</p><pre tabindex=0><code>ARG MINIMAL
ARG NO_KEYS
</code></pre><p>The next two variables define the default UID and GID of the <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/AdministratorsGuide/DBUsersAndPrivileges/Roles/DBADMINRole.htm>dbadmin</a> user account in the container:</p><pre tabindex=0><code>ARG DBADMIN_GID=5000  
ARG DBADMIN_UID=5000
</code></pre><h4 id=adding-files>Adding Files</h4><p>The <code>COPY</code> instruction copies files from the host filesystem into the container filesystem.</p><p>The following <code>COPY</code> instruction copies your Vertica RPM to the container&rsquo;s <code>/tmp</code> folder. This is used to install Vertica in the container:</p><pre tabindex=0><code>COPY ./packages/$VERTICA_RPM /tmp/
</code></pre><p>The following <code>COPY</code> instructions add bash scripts that clean up your image and reduce its size. They are available in the <code>vertica-kubernetes/docker-vertica/packages</code> folder:</p><ul><li><strong>cleanup.sh</strong> strips debugging symbols from the libraries in <code>/opt/vertica/packages</code> directory, decreasing the image size. If you set <code>ARG MINIMAL=YES</code>, this script removes any packages that are not installed automatically, such as Tensorflow.</li><li><strong>package-checksum-patcher.py</strong> patches the library installers to use new checksums that <strong>cleanup.sh</strong> created when removing the debugging symbols.</li></ul><pre tabindex=0><code>COPY ./packages/cleanup.sh /tmp/  
COPY ./packages/package-checksum-patcher.py /tmp/
</code></pre><p>The following <code>COPY</code> instructions add config files for sshd and ssh. These config files are used to ensure all environment variables are passed and accepted from the ssh client to the ssh server. This is needed so that when we start vertica, environment variables that are set in the pod are picked up by the server.</p><pre tabindex=0><code>COPY ./packages/10-vertica-sshd.conf /etc/ssh/sshd_config.d/10-vertica-sshd.conf
COPY ./packages/10-vertica-ssh.conf /etc/ssh/ssh_config.d/10-vertica-ssh.conf
</code></pre><h4 id=installing-dependencies>Installing Dependencies</h4><p>This section incrementally builds a single <code>RUN</code> instruction. The <code>RUN</code> instruction executes Bash commands that persist in your container.</p><p>Each <code>RUN</code> instruction adds a layer to the final image. To limit the number of <code>RUN</code> instructions, use the Bash <strong>&&</strong> operator to chain multiple <code>RUN</code> commands into a single command. To chain commands that span multiple lines into a single command, enter the backslash ( <strong>\</strong> ) character at the end of the line.</p><h5 id=set-up-the-shell>Set up the shell</h5><p>The following command ensures that the build fails if any of the subsequent <code>RUN</code> commands fail:</p><pre tabindex=0><code>SHELL [&#34;/bin/bash&#34;, &#34;-o&#34;, &#34;pipefail&#34;, &#34;-c&#34;]
</code></pre><h5 id=begin-the-run-instruction>Begin the RUN Instruction</h5><p>Add <code>RUN set -x</code> to log each command to the console as it is executed:</p><pre tabindex=0><code>RUN set -x \
</code></pre><p>Indent the following commands 2 spaces further than the <code>RUN set -x \</code> command.</p><h6 id=update-the-packages>Update the Packages</h6><p>To begin, update all packages:</p><pre tabindex=0><code>  &amp;&amp; yum -q -y update \
</code></pre><h5 id=vertica-and-admintools-required-packages>Vertica and Admintools Required Packages</h5><p>Vertica and <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/AdministratorsGuide/AdminTools/AdministrationToolsReference.htm>Admintools</a> require the following packages to function properly:</p><pre tabindex=0><code>  &amp;&amp; yum install -y \  
     cronie \  
     dialog \  
     glibc \  
     glibc-langpack-en \  
     iproute \  
     openssh-server \  
     openssh-clients \  
     openssl \  
     sudo \  
     which \  
     zlib-devel \
</code></pre><h5 id=configure-the-dbadmin-role-and-group>Configure the dbadmin Role and Group</h5><p>Create the required <strong>verticadba</strong> group and add the <strong>dbadmin</strong> user:</p><pre tabindex=0><code>  &amp;&amp; /usr/sbin/groupadd -r verticadba --gid ${DBADMIN_GID} \  
  &amp;&amp; /usr/sbin/useradd -r -m -s /bin/bash -g verticadba --uid ${DBADMIN_UID} dbadmin \
</code></pre><h5 id=install-the-locally-sourced-rpm>Install the Locally-Sourced RPM</h5><p>Install the RPM from the <code>docker-vertica/packages</code> directory in the container <code>/tmp</code> directory:</p><pre tabindex=0><code>  &amp;&amp; yum localinstall -q -y /tmp/${VERTICA_RPM} \
</code></pre><h5 id=run-install_vertica-script>Run install_vertica Script</h5><p>To prepare the Vertica environment, run the <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/InstallationGuide/InstallingVertica/InstallVerticaScript.htm>install_vertica script</a>:</p><pre tabindex=0><code>  &amp;&amp; /opt/vertica/sbin/install_vertica \  
  --accept-eula \  
  --debug \  
  --dba-user-password-disabled \  
  --failure-threshold NONE \  
  --license CE \  
  --hosts 127.0.0.1 \  
  --no-system-configuration \  
  --ignore-install-config \  
  -U \  
  --data-dir /home/dbadmin \
</code></pre><h5 id=add-license-files>Add License Files</h5><p>If you used the <a href=https://www.vertica.com/landing-page/start-your-free-trial-today/>Community Edition license</a>, create a directory to install the Community Edition license key:</p><pre tabindex=0><code>  &amp;&amp; mkdir -p /home/dbadmin/licensing/ce \  
  &amp;&amp; cp -r /opt/vertica/config/licensing/* /home/dbadmin/licensing/ce/ \
</code></pre><p>Configure <a href=https://www.vertica.com/docs/11.0.x/HTML/Content/Authoring/AdministratorsGuide/Monitoring/Vertica/RotatingLogFiles.htm>logrotate</a> to simplify log file administration:</p><pre tabindex=0><code>  &amp;&amp; mkdir -p /home/dbadmin/logrotate \  
  &amp;&amp; cp -r /opt/vertica/config/logrotate /home/dbadmin/logrotate/  \  
  &amp;&amp; cp /opt/vertica/config/logrotate_base.conf /home/dbadmin/logrotate/ \
</code></pre><p>Provide the dbadmin user ownership of the Vertica files:</p><pre tabindex=0><code>  &amp;&amp; chown -R dbadmin:verticadba /opt/vertica \
</code></pre><h5 id=clean-up-install-files>Clean Up Install Files</h5><p>Run the <code>cleanup.sh</code> script to reduce the size of the final image:</p><pre tabindex=0><code>  &amp;&amp; rm -rf /opt/vertica/lib64  \  
  &amp;&amp; yum clean all \  
  &amp;&amp; sh /tmp/cleanup.sh
</code></pre><h4 id=prepare-the-static-ssh-keys>Prepare the static ssh keys</h4><p>We use static SSH key for the dbadmin id. This is required so that if the environment runs multiple versions of the image, then all nodes can communicate through SSH.</p><pre tabindex=0><code>COPY dbadmin/.ssh /home/dbadmin/.ssh  
</code></pre><h4 id=configure-container-network-and-access-privileges>Configure Container Network and Access Privileges</h4><h5 id=begin-the-run-instruction-1>Begin the RUN Instruction</h5><p>Add <code>RUN set -x</code> to log each command to the console as it is executed:</p><pre tabindex=0><code>RUN set -x \
</code></pre><h5 id=copy-ssh-keys>Copy SSH Keys</h5><p>The following commands copy the static SSH key to use for root and ensures all keys have the proper permissions:</p><pre tabindex=0><code>  &amp;&amp; mkdir -p /root/.ssh \  
  &amp;&amp; if [[ ${NO_KEYS^^} != &#34;YES&#34; ]] ; then \
    cp -r /home/dbadmin/.ssh /root; \
    chmod 700 /root/.ssh; \
    chmod 600 /root/.ssh/*; \
  fi \
</code></pre><h5 id=ensure-proper-ownership-and-permissions>Ensure proper ownership and permissions</h5><p>Ensure that everything under /home/dbadmin has the correct ownership and the ssh config files have the correct permissions:</p><pre tabindex=0><code>  &amp;&amp; chown -R dbadmin:verticadba /home/dbadmin/ \
  &amp;&amp; chmod go-w /etc/ssh/sshd_config.d/* /etc/ssh/ssh_config.d/* \
  &amp;&amp; if [[ ${NO_KEYS^^} == &#34;YES&#34; ]] ; then \
    rm -rf /home/dbadmin/.ssh/*;  \
  fi
</code></pre><h3 id=second-stage>Second Stage</h3><p>The second stage prepares the OS for the final image. It updates packages to address all known security vulnerabilities. This stage hands off to the third and final stage to remove any intermediate files that are needed for the package update.</p><p>The beginning of the second stage is indicated by a row of <strong>#</strong> characters in the Dockerfile.</p><h4 id=choosing-your-operating-system>Choosing Your Operating System</h4><p>As previously mentioned, the second stage uses Ubuntu as the operating system. You can set the OS version with the <code>BASE_OS_VERSION</code> variable that you set earlier:</p><pre tabindex=0><code>FROM ubuntu:${BASE_OS_VERSION}
</code></pre><h3 id=third-stage>Third Stage</h3><p>The third and final build stage:</p><ul><li>copies only the necessary build artifacts from the first two stages to reduce the number of layers in the final image.</li><li>creates environment variables.</li><li>exposes ports for networking.</li><li>adds metadata to the image.</li></ul><h4 id=set-up-stage>Set Up Stage</h4><p>Start with an empty image called <code>scratch</code> and copy everything from the second stage:</p><pre tabindex=0><code>FROM scratch
COPY --from=initial / /
</code></pre><p>This removes any intermediate layers that were created to update the OS packages.</p><h4 id=additional-arg-variables>Additional ARG Variables</h4><p>Reuse the ARG variables from the first stage that define Vertica license and user information:</p><pre tabindex=0><code>ARG DBADMIN_GID=5000  
ARG DBADMIN_UID=5000
</code></pre><p>In the previous example:</p><ul><li><strong>DBADMIN_GID</strong> is the default GID for the <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/AdministratorsGuide/DBUsersAndPrivileges/Roles/DBADMINRole.htm>dbadmin</a> account in the container.</li><li><strong>DBADMIN_UID</strong> is the default UID for the <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/AdministratorsGuide/DBUsersAndPrivileges/Roles/DBADMINRole.htm>dbadmin</a> account in the container.</li></ul><p>Select the Java runtime version to install. This must correspond with a package name found in the Ubuntu distribution:</p><pre tabindex=0><code>ARG JRE_PKG=openjdk-8-jre-headless
</code></pre><p>Inherit the arguments in the previous build stage:</p><pre tabindex=0><code>ARG MINIMAL
ARG S6_OVERLAY_VERSION
</code></pre><h4 id=copy-artifacts-from-the-first-stage>COPY Artifacts from the First Stage</h4><p>The <code>COPY</code> command adds files into the image as a new layer. The <code>--from=builder </code><source-location><code></code><container-location>option copies build artifacts from the first builder stage of the Dockerfile without the tools or files required to build them:</p><pre tabindex=0><code>COPY --from=builder /opt/vertica /opt/vertica  
COPY --from=builder --chown=$DBADMIN_UID:$DBADMIN_GID /home/dbadmin /home/dbadmin  
COPY --from=builder /root/.ssh /root/.ssh  
COPY --from=builder /var/spool/cron /var/spool/cron  
COPY --from=builder /etc/ssh/sshd_config.d/* /etc/ssh/sshd_config.d/
COPY --from=builder /etc/ssh/ssh_config.d/* /etc/ssh/ssh_config.d/
</code></pre><h4 id=setting-environment-variables>Setting Environment Variables</h4><p>Values set with the <code>ENV</code> instruction set environment variables available in the running container:</p><pre tabindex=0><code>ENV PATH &#34;$PATH:/opt/vertica/bin:/opt/vertica/sbin&#34;
ENV DEBIAN_FRONTEND noninteractive
</code></pre><p>In the previous example:</p><ul><li><strong>PATH</strong> sets the $PATH in the container to include the Vertica binaries and system binaries.</li><li><strong>DEBIAN_FRONTEND</strong> set to <code>noninteractive</code> ensures that there is zero interaction while installing or upgrading the system with <code>apt</code>.</li></ul><h4 id=install-daemon-scripts>Install Daemon Scripts</h4><p>Because the container does not run systemd by default, we provide functions to enable the <code>vertica_agent</code> script to function properly:</p><pre tabindex=0><code>ADD ./packages/init.d.functions /etc/rc.d/init.d/functions
</code></pre><h4 id=install-init-program>Install init program</h4><p>The init program that we use in the container is called <a href=https://github.com/just-containers/s6-overlay>s6</a>. It is like systemd, but is designed for containers. It behaves like a true init program (PID 1): reaping zombie processes, passing signals down to child process, and restarting long-running services. Both cron and sshd are setup as long-running services. If any of those two services stop running, s6 restarts them.</p><p>The following commands copies over scripts and binaries needed to run s6:</p><pre tabindex=0><code>ADD https://github.com/just-containers/s6-overlay/releases/download/v${S6_OVERLAY_VERSION}/s6-overlay-noarch.tar.xz /tmp
ADD https://github.com/just-containers/s6-overlay/releases/download/v${S6_OVERLAY_VERSION}/s6-overlay-x86_64.tar.xz /tmp
</code></pre><p>The following command copies our custom config for s6 so that sshd and cron are created as long-running services:</p><pre tabindex=0><code>COPY s6-rc.d/ /etc/s6-overlay/s6-rc.d/
</code></pre><h4 id=installing-dependencies-1>Installing Dependencies</h4><p>This section incrementally builds a single <code>RUN</code> instruction. The <code>RUN</code> instruction executes Bash commands that persist in your container.</p><p>Each <code>RUN</code> instruction adds a layer to the final image. To limit the number of <code>RUN</code> instructions, use the Bash <strong>&&</strong> operator to chain multiple <code>RUN</code> commands into a single command.</p><p>Many of the following commands are similar to those added in the previous build stage.</p><h5 id=setup-the-shell>Setup the SHELL</h5><p>Setup the shell so that commands fail if a command flowing through a <code>|</code> fails.</p><pre tabindex=0><code>SHELL [&#34;/bin/bash&#34;, &#34;-o&#34;, &#34;pipefail&#34;, &#34;-c&#34;]
</code></pre><h5 id=begin-the-run-instruction-2>Begin the RUN Instruction</h5><p>Add <code>RUN set -x</code> to log each command to the console as it is executed:</p><pre tabindex=0><code>RUN set -x \
</code></pre><p>Be sure to indent all of the following commands 2 spaces further than the <code>RUN set -x \</code> command.</p><h5 id=update-the-packages-1>Update the Packages</h5><p>Update the package cache so that you can install packages:</p><pre tabindex=0><code>  &amp;&amp; apt-get -y update \
</code></pre><h5 id=vertica-and-admintools-required-packages-1>Vertica and Admintools Required Packages</h5><p>Vertica and <a href=https://www.vertica.com/docs/latest/HTML/Content/Authoring/AdministratorsGuide/AdminTools/AdministrationToolsReference.htm>Admintools</a> require the following packages to function properly. There are also some additional packages included to make it easier when running <code>kubectl exec</code> for the container.</p><pre tabindex=0><code>  &amp;&amp; apt-get install -y --no-install-recommends \  
  ca-certificates \  
  cron \  
  dialog \  
  gdb \  
  iproute2 \  
  krb5-user \  
  less \
  libkeyutils1\  
  libz-dev \  
  locales \  
  logrotate \  
  ntp \  
  openssh-client \  
  openssh-server \  
  openssl \  
  procps \  
  sysstat \  
  sudo \   
</code></pre><h5 id=install-java>Install Java</h5><p>Add the following only if you are building a minimal image:</p><pre tabindex=0><code>  &amp;&amp; if [[ ${MINIMAL^^} != &#34;YES&#34; ]] ; then \
    apt-get install -y --no-install-recommends $JRE_PKG; \
  fi \
</code></pre><h5 id=install-vim>Install vim</h5><p>Add the Vim text editor for debugging purposes. The <code>vim</code> package can be old, and some security scanners might find vulnerabilities in it. For this reason, it is not included it in the NO_KEYS image, which should be used in environments with strict security requirements.</p><pre tabindex=0><code>  &amp;&amp; if [[ ${NO_KEYS^^} != &#34;YES&#34; ]] ; then \
    apt-get install -y --no-install-recommends vim-tiny; \
  fi \
</code></pre><h5 id=cleanup-package-manager>Cleanup package manager</h5><p>Remove any cached data brought in from the package manager:</p><pre tabindex=0><code>  &amp;&amp; apt-get clean \
  &amp;&amp; apt-get autoremove \
  &amp;&amp; rm -rf /var/lib/apt/lists/* \  
</code></pre><h5 id=setup-the-locale>Setup the locale</h5><p>Make the <code>en_US.UTF-8</code> locale so that Vertica will use utf-8 by default:</p><pre tabindex=0><code>  &amp;&amp; localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8 \
</code></pre><h5 id=ssh-setup>SSH Setup</h5><p>This ensures the ssh daemon can start:</p><pre tabindex=0><code>  &amp;&amp; mkdir -p /run/sshd \  
  &amp;&amp; ssh-keygen -q -A \
</code></pre><h5 id=configure-the-dbadmin-role-and-group-1>Configure the dbadmin Role and Group</h5><p>Create the required <strong>verticadba</strong> group and add the <strong>dbadmin</strong> user:</p><pre tabindex=0><code>  &amp;&amp; /usr/sbin/groupadd -r verticadba --gid ${DBADMIN_GID} \  
  &amp;&amp; /usr/sbin/useradd -r -m -s /bin/bash -g verticadba --uid ${DBADMIN_UID} dbadmin \
</code></pre><h5 id=allow-passwordless-sudo-access-for-dbadmin>Allow Passwordless sudo Access for dbadmin</h5><pre tabindex=0><code>  &amp;&amp; echo &#34;dbadmin ALL=(ALL) NOPASSWD: ALL&#34; | tee -a /etc/sudoers \
</code></pre><h5 id=setup-limits-for-dbadmin>Setup limits for dbadmin</h5><pre tabindex=0><code>  &amp;&amp; echo &#34;dbadmin -       nofile  65536&#34; &gt;&gt; /etc/security/limits.conf \
</code></pre><h5 id=setup-java>Setup Java</h5><p>We set the <code>JAVA_HOME</code> environment variable if we included Java in this image. This is used by Vertica to know where to find the Java runtime:</p><pre tabindex=0><code>  &amp;&amp; if $MINIMAL != &#34;YES&#34; &amp;&amp; $MINIMAL != &#34;yes&#34; ; then \
    echo &#34;JAVA_HOME=/usr&#34; &gt;&gt; /etc/environment; \
  fi \
</code></pre><h5 id=set-python-path>Set Python Path</h5><p>This step allows you to call Python from anywhere in the system. This is only required to allow us to run the UDx samples, as some samples use a Python script to generate data for ingestion:</p><pre tabindex=0><code>  &amp;&amp; update-alternatives --install /usr/bin/python python /opt/vertica/oss/python3/bin/python3 1 \
</code></pre><h5 id=make-cron-a-setuid-program>Make cron a setuid program</h5><p>This step changes cron so that it&rsquo;s setuid. This is done so that s6 doesn&rsquo;t t have to run <code>sudo cron ...</code> to start it.</p><pre tabindex=0><code>  &amp;&amp; chmod u+s /usr/sbin/cron \
</code></pre><h5 id=unpack-s6>Unpack s6</h5><p>We copied s6 tar files in an earlier step. This will extract them into the root of the file system and delete the old host SSH keys:</p><pre tabindex=0><code>  &amp;&amp; tar -C / -Jxpf /tmp/s6-overlay-x86_64.tar.xz \
  &amp;&amp; tar -C / -Jxpf /tmp/s6-overlay-noarch.tar.xz \
  &amp;&amp; rm -rf /etc/ssh/ssh_host* 
</code></pre><h3 id=the-entrypoint-script>The Entrypoint Script</h3><p>The entrypoint script is what executes to create a container from your image. We call the s6 init program and let it supervise the start of other processes:</p><pre tabindex=0><code>ENTRYPOINT [&#34;/init&#34;]
</code></pre><h3 id=exposing-ports>Exposing Ports</h3><p>Expose port 5433 for Vertica, 8443 for Vertica&rsquo;s HTTP server, and 5444 for Vertica&rsquo;s agent:</p><pre tabindex=0><code>EXPOSE 5433  
EXPOSE 8443
EXPOSE 5444
</code></pre><h3 id=configuring-image-access>Configuring Image Access</h3><p>Set the default user that runs the image to dbadmin:</p><pre tabindex=0><code>USER dbadmin
</code></pre><h3 id=adding-labels-to-the-image>Adding Labels to the Image</h3><p>Labels enable you to add metadata to your image, which is helpful when storing images in repositories and tracking build information. Vertica uses the following <code>LABELS</code>:</p><pre tabindex=0><code>LABEL os-family=&#34;ubuntu&#34;  
LABEL image-name=&#34;vertica_k8s&#34;  
LABEL maintainer=&#34;K8s Team&#34;  
LABEL org.opencontainers.image.source=[https://github.com/vertica/vertica-kubernetes/tree/main/docker-vertica](https://github.com/vertica/vertica-kubernetes/tree/main/docker-vertica) \  
      org.opencontainers.image.title=&#39;Vertica Server&#39; \  
      org.opencontainers.image.description=&#39;Runs the Vertica server that is optimized for use with the VerticaDB operator&#39; \  
      org.opencontainers.image.url=[https://github.com/vertica/vertica-kubernetes/](https://github.com/vertica/vertica-kubernetes/) \  
      org.opencontainers.image.documentation=[https://www.vertica.com/docs/latest/HTML/Content/Authoring/Containers/ContainerizedVertica.htm](https://www.vertica.com/docs/latest/HTML/Content/Authoring/Containers/ContainerizedVertica.htm)
</code></pre></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Open Text Corporation All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=../../js/main.min.b6b5dd18889117d69a57d2b6ed518450be5b0d0206550559698a4233c65c109f.js integrity="sha256-trXdGIiRF9aaV9K27VGEUL5bDQIGVQVZaYpCM8ZcEJ8=" crossorigin=anonymous></script>
<script src=../../js/prism.js></script>
<script src=../../js/tabpane-persist.js></script></body></html>