<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.99.1"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../favicons/favicon.ico><link rel=apple-touch-icon href=../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../favicons/android-192x192.png sizes=192x192><title>Client access with VClusterOps |</title><meta name=description content="In version 24.1.0, Vertica introduces a modernized backend that uses various HTTPS endpoints and communicates with REST APIs. The new backend dramatically reduces the time it takes to set up and execute administrative commands.
Prior to this version, Vertica managed all server and containerized deployments with Admintools, a traditional CLI that accepts parameters through STDIN and outputs unstructured results to STDOUT, and requires SSH for passwordless access so that it can communicate with all the nodes in the cluster."><meta property="og:title" content="Client access with VClusterOps "><meta property="og:description" content="In version 24.1.0, Vertica introduces a modernized backend that uses various HTTPS endpoints and communicates with REST APIs. The new backend dramatically reduces the time it takes to set up and execute administrative commands.
Prior to this version, Vertica managed all server and containerized deployments with Admintools, a traditional CLI that accepts parameters through STDIN and outputs unstructured results to STDOUT, and requires SSH for passwordless access so that it can communicate with all the nodes in the cluster."><meta property="og:type" content="article"><meta property="og:url" content="/containers/vcluster-ops/"><meta property="article:section" content="containers"><meta itemprop=name content="Client access with VClusterOps "><meta itemprop=description content="In version 24.1.0, Vertica introduces a modernized backend that uses various HTTPS endpoints and communicates with REST APIs. The new backend dramatically reduces the time it takes to set up and execute administrative commands.
Prior to this version, Vertica managed all server and containerized deployments with Admintools, a traditional CLI that accepts parameters through STDIN and outputs unstructured results to STDOUT, and requires SSH for passwordless access so that it can communicate with all the nodes in the cluster."><meta itemprop=wordCount content="1238"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Client access with VClusterOps "><meta name=twitter:description content="In version 24.1.0, Vertica introduces a modernized backend that uses various HTTPS endpoints and communicates with REST APIs. The new backend dramatically reduces the time it takes to set up and execute administrative commands.
Prior to this version, Vertica managed all server and containerized deployments with Admintools, a traditional CLI that accepts parameters through STDIN and outputs unstructured results to STDOUT, and requires SSH for passwordless access so that it can communicate with all the nodes in the cluster."><link rel=preload href=../../scss/main.min.8a6ed667b3d1bd12fba7ff44e1fe8c839f35d62b1dd330530f402a195a4dac52.css as=style><link href=../../scss/main.min.8a6ed667b3d1bd12fba7ff44e1fe8c839f35d62b1dd330530f402a195a4dac52.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<link rel=stylesheet href=../../css/prism.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=../../><span class="navbar-brand__logo navbar-logo"><svg width="398" height="142" viewBox="0 0 398 142" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMinYMin"><title>Vertica-OT-White</title><g id="Outlined" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Logos---Outlined-(Dark-Bg)" transform="translate(-970.000000, -645.000000)" fill="#fff" fill-rule="nonzero"><path d="M979.5728 750.5824H982.9136V760.912C983.7328 759.8368 984.68 759.0048 985.7552 758.416 986.8304 757.8272 988.0976 757.5328 989.5568 757.5328 990.9648 757.5328 992.2 757.7888 993.2624 758.3008 994.3248 758.8128 995.208 759.5296 995.912 760.4512 996.616 761.3728 997.1408 762.4672 997.4864 763.7344S998.0048 766.4032 998.0048 767.9392C998.0048 769.5776 997.8 771.056 997.3904 772.3744S996.392 774.8128 995.624 775.7344C994.856 776.656 993.928 777.3664 992.84 777.8656 991.752 778.3648 990.5296 778.6144 989.1728 778.6144 988.0208 778.6144 986.9008 778.3776 985.8128 777.904 984.7248 777.4304 983.7456 776.6176 982.8752 775.4656V778H979.5728V750.5824zM982.8752 768.6304C982.8752 769.9104 983.0224 771.0048 983.3168 771.9136 983.6112 772.8224 984.0144 773.5712 984.5264 774.16 985.0384 774.7488 985.6528 775.1776 986.3696 775.4464 987.0864 775.7152 987.8672 775.8496 988.712 775.8496 989.5312 775.8496 990.2928 775.7088 990.9968 775.4272S992.3088 774.6912 992.8208 774.064C993.3328 773.4368 993.736 772.624 994.0304 771.6256 994.3248 770.6272 994.472 769.4112 994.472 767.9776 994.472 766.5184 994.312 765.296 993.992 764.3104 993.672 763.3248 993.256 762.5376 992.744 761.9488 992.232 761.36 991.6496 760.9376 990.9968 760.6816S989.672 760.2976 988.9808 760.2976C988.1104 760.2976 987.304 760.4448 986.5616 760.7392S985.1728 761.4688 984.6224 762.0448C984.072 762.6208 983.6432 763.3504 983.336 764.2336S982.8752 766.1344 982.8752 767.2864V768.6304zm19.5456 13.5936C1003.1376 782.48 1003.8544 782.608 1004.5712 782.608 1005.3904 782.608 1006.024 782.3968 1006.472 781.9744 1006.92 781.552 1007.3616 780.7648 1007.7968 779.6128L1008.6032 777.5008 1000.1936 758.1472H1004.072L1010.3312 773.7376 1016.0528 758.1472H1019.7392L1011.0608 779.8816C1010.7024 780.7776 1010.344 781.5648 1009.9856 782.2432 1009.6272 782.9216 1009.2304 783.504 1008.7952 783.9904S1007.8416 784.8416 1007.24 785.0848 1005.9024 785.4496 1005.032 785.4496C1004.4176 785.4496 1003.8672 785.4112 1003.3808 785.3344 1002.8944 785.2576 1002.3568 785.1168 1001.768 784.912L1002.4208 782.224zm68.6254-26.884714c5.90264000000002.0 10.10727 4.33928500000002 10.10727 12.133928C1081.15347 772.294643 1079.37459 779.848214 1070.72277 779.848214 1067.65017 779.848214 1065.22442 778.160714 1064.65842 777.196429V787H1057.5429V755.901786H1064.73927V757.991071C1065.38614 756.946429 1067.56931 755.339286 1071.0462 755.339286zm-28.13861.0C1052.77228 755.901786 1054.95545 763.294643 1054.95545 767.553571 1054.95545 773.5 1051.39769 779.928571 1042.01815 779.928571 1035.22607 779.928571 1029 776.232143 1029 767.553571 1029 760.401786 1033.68977 754.857143 1042.90759 755.339286zM1104.60231 758.392857C1107.75578 761.6875 1107.91749 766.267857 1107.99835 768.919643H1090.61386C1090.61386 771.8125 1092.31188 774.785714 1096.19307 774.785714S1101.44884 772.294643 1102.33828 770.6875L1107.67492 773.258929C1107.02805 774.625 1104.92574 779.928571 1095.62706 779.928571c-7.19637000000012.0-12.20957-4.25892800000008-12.20957-11.973214.0-5.625 2.91088999999988-12.616071 12.4521499999998-12.616071C1097.32508 755.339286 1101.44884 755.178571 1104.60231 758.392857zM1170.17822 758.3125C1173.33168 761.607143 1173.4934 766.1875 1173.57426 768.839286H1156.27063C1156.18977 771.732143 1157.72607 774.705357 1161.5264 774.705357 1165.40759 774.705357 1166.5396 772.214286 1167.42904 770.607143L1172.84653 773.258929 1171.47195 775.267857C1170.17822 777.035714 1167.83333 779.848214 1160.9604 779.848214 1153.76403 779.848214 1148.9934 775.589286 1148.9934 767.875 1148.9934 762.25 1151.90429 755.258929 1161.44554 755.258929L1161.67122 755.258217C1163.29153 755.251276 1167.17492 755.251276 1170.17822 758.3125zM1206.88779 751V755.982143H1211.57756V760.803571H1206.88779V771.169643C1206.80693 772.616071 1206.80693 773.821429 1208.74752 773.821429L1211.25413 773.741071V779.125C1209.79868 779.366071 1208.82838 779.526786 1207.53465 779.526786 1205.02805 779.526786 1202.35974 779.366071 1200.82343 777.196429 1199.85314 775.830357 1199.77228 774.142857 1199.77228 771.892857V760.723214H1195.40594L1198.64026 755.901786H1199.77228V751H1206.88779zM1143.17162 751V755.901786H1150.5297L1147.29538 760.723214H1143.09076v10.446429C1143.0099 772.616071 1143.0099 773.821429 1144.9505 773.821429L1147.4571 773.741071V779.125C1145.92079 779.366071 1145.03135 779.526786 1143.73762 779.526786 1141.31188 779.526786 1138.56271 779.366071 1137.0264 777.196429 1136.05611 775.830357 1135.97525 774.142857 1135.97525 771.892857V751H1143.17162zM1125.14026 755.339286C1126.59571 755.339286 1128.21287 755.580357 1129.42574 756.223214 1131.93234 757.508929 1132.66007 759.598214 1132.66007 763.294643V779.366071H1125.4637V766.107143C1125.4637 764.017857 1125.38284 763.214286 1125.14026 762.571429 1124.57426 761.285714 1123.36139 760.803571 1121.90594 760.803571 1118.50302 760.803571 1118.21341 763.224981 1118.18876 765.914004L1118.18676 766.290737 1118.18647 779.366071H1111.07096V755.901786H1118.26733V757.991071C1118.99505 757.267857 1119.39934 756.705357 1120.69307 756.142857 1121.82508 755.660714 1123.36139 755.339286 1125.14026 755.339286zM1180.28548 755.982143 1184.08581 761.205357 1187.56271 755.982143H1195.64851L1188.29043 767.071429 1197.18482 779.366071H1189.01815L1184.32838 772.857143 1180.0429 779.366071H1171.9571L1180.20462 767.071429 1172.19967 755.982143H1180.28548zM1041.533 760.883929C1039.59241 760.964286 1038.37954 761.607143 1037.40924 763.053571 1036.5198 764.339286 1036.19637 765.946429 1036.19637 767.553571 1036.19637 771.169643 1038.05611 774.464286 1042.01815 774.464286 1045.89934 774.464286 1047.75908 771.410714 1047.75908 767.875 1047.75908 765.303571 1047.11221 763.375 1045.73762 762.169643 1044.28218 760.883929 1042.58416 760.803571 1041.533 760.883929zM1069.59076 760.723214C1068.29703 760.723214 1066.92244 761.205357 1065.95215 762.491071 1064.90099 763.696429 1064.4967 765.544643 1064.4967 767.633929 1064.4967 770.366071 1065.30528 772.053571 1066.19472 773.017857 1067.0033 773.901786 1068.21617 774.464286 1069.42904 774.464286 1072.90594 774.464286 1074.44224 770.928571 1074.44224 767.473214 1074.44224 764.580357 1073.55281 761.526786 1070.64191 760.883929 1070.23762 760.803571 1069.91419 760.723214 1069.59076 760.723214zM1095.70792 760C1094.0099 760 1092.79703 760.803571 1092.06931 761.526786 1091.09901 762.571429 1090.85644 763.616071 1090.61386 764.660714L1100.55941 764.580357C1100.39769 763.616071 1100.23597 762.25 1099.18482 761.285714 1098.29538 760.401786 1096.92079 760 1095.70792 760zM1161.36469 760C1159.66667 760 1158.4538 760.803571 1157.72607 761.526786 1156.75578 762.571429 1156.5132 763.616071 1156.27063 764.660714L1166.21617 764.580357C1166.05446 763.616071 1165.89274 762.25 1164.84158 761.285714 1163.95215 760.401786 1162.57756 760 1161.36469 760zM1221.28053 755.982143 1222.4934 759.839286 1223.70627 755.982143H1224.91914V760.803571H1224.11056V757.830357L1224.19142 756.866071 1223.94884 757.669643 1222.89769 760.883929H1222.08911L1221.03795 757.669643 1220.79538 756.866071 1220.87624 757.830357V760.803571H1220.06766V755.982143H1221.28053zM1219.66337 755.901786V756.625H1218.0462V760.803571H1217.23762V756.625H1215.62046V755.901786H1219.66337zM983.707685 647.665636 1012.49328 698.718315l28.88386-51.052679H1092.69771V659.626331h-44.32753L1012.58608 723 970 647.665636h13.707685zm108.992755 30.353198v11.960695H1053.70641v17.747247H1092.70044v11.960696H1041.74562V678.018834H1092.70044zM1218.81169 719.684742h11.95533V647.663998h-11.95533v72.020744zm-82.14076-72.016377C1148.0749 647.668365 1157.27341 656.8668 1157.27341 668.270676 1157.27341 676.824948 1151.93991 684.276499 1144.3955 687.31171L1162.05554 719.689109h-11.95533L1133.26448 688.780184h-23.6377V719.689109h-11.95533V647.668365zM1214.11799 647.666181V659.621418H1189.55771v60.065508h-11.95533V659.621418H1161.31802C1159.66393 654.932126 1156.8143 650.886998 1153.04209 647.851788V647.666181H1214.11799zm-77.44706 11.95742H1109.62678V676.917751H1136.67093C1141.45307 676.917751 1145.31808 673.05277 1145.31808 668.270676S1141.45307 659.623601 1136.67093 659.623601zm186.44473-14.624693L1292.3921 696.138932V696.231735C1288.06853 703.404877 1280.25116 708.19243 1271.33107 708.19243 1257.71618 708.19243 1246.67798 697.154308 1246.67798 683.539532c0-13.614775 11.0382-24.6528970000001 24.65309-24.6528970000001C1279.6998 658.886635 1287.0586 663.024566 1291.56778 669.4662L1298.00401 658.706487C1291.38217 651.527886 1281.90525 647.117005 1271.33107 647.117005 1251.18716 647.117005 1234.9028 663.395778 1234.9028 683.539532 1234.9028 703.683286 1251.18716 719.96206 1271.33107 719.96206 1284.57473 719.96206 1296.1643 712.881721 1302.60599 702.302156L1323.11566 668.08507 1354.20497 719.869257 1368 719.689109 1323.11566 644.998908z" id="Vertica-OT-White"/></g></g></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.vertica.com/docs/latest/HTML/Content/Home.htm target=_blank><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.vertica.com/knowledgebase/ target=_blank><span>Knowledge Base</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://academy.vertica.com/ target=_blank><span>Academy</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://forum.vertica.com/ target=_blank><span>Forum</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://www.microfocus.com/en-us/support/Vertica%20Analytics%20Platform target=_blank><span>Support</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=../../ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Vertica Integrator's Guide</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-server-installation-li><input type=checkbox id=m-server-installation-check>
<label for=m-server-installation-check><a href=../../server-installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-server-installation><span>Server installation and configuration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-containers-li><input type=checkbox id=m-containers-check checked>
<label for=m-containers-check><a href=../../containers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-containers><span>Containerized Vertica</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containerscreating-image-li><input type=checkbox id=m-containerscreating-image-check>
<label for=m-containerscreating-image-check><a href=../../containers/creating-image/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containerscreating-image><span>Creating a Vertica image</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containersk8s-dev-env-li><input type=checkbox id=m-containersk8s-dev-env-check>
<label for=m-containersk8s-dev-env-check><a href=../../containers/k8s-dev-env/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containersk8s-dev-env><span>Vertica on Kubernetes development environment</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-containersprometheus-metrics-blog-li><input type=checkbox id=m-containersprometheus-metrics-blog-check>
<label for=m-containersprometheus-metrics-blog-check><a href=../../containers/prometheus-metrics-blog/ title="Scraping metrics with Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-containersprometheus-metrics-blog><span>Scraping Prometheus metrics</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-containersvcluster-ops-li><input type=checkbox id=m-containersvcluster-ops-check checked>
<label for=m-containersvcluster-ops-check><a href=../../containers/vcluster-ops/ title="Client access with VClusterOps " class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-containersvcluster-ops><span class=td-sidebar-nav-active-item id=td-sidebar-nav-active-item>VClusterOps access</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-data-protocols-formats-li><input type=checkbox id=m-data-protocols-formats-check>
<label for=m-data-protocols-formats-check><a href=../../data-protocols-formats/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-data-protocols-formats><span>Data protocols and formats</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-cli-args-li><input type=checkbox id=m-cli-args-check>
<label for=m-cli-args-check><a href=../../cli-args/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-cli-args><span>Command line arguments</span></a></label></li></ul></li></ul></nav></div><script>var myElement=document.getElementById("td-sidebar-nav-active-item");myElement.scrollIntoView({behavior:"auto",block:"center",inline:"start"})</script></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#set-up-k8s-cluster>Set up K8s cluster</a></li><li><a href=#deploy-the-verticadb-operator>Deploy the VerticaDB operator</a></li><li><a href=#create-a-vertica-cluster>Create a Vertica cluster</a></li><li><a href=#client-access-to-the-rest-api>Client access to the REST API</a><ul><li><a href=#view-the-swagger-documentation>View the Swagger documentation</a></li><li><a href=#get-prometheus-metrics>Get Prometheus metrics</a></li><li><a href=#scale-out-a-subcluster>Scale out a subcluster</a></li></ul></li><li><a href=#tear-down-k8s-cluster>Tear down K8s cluster</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../containers/>Containerized Vertica</a></li><li class="breadcrumb-item active" aria-current=page><a href=../../containers/vcluster-ops/ aria-disabled=true class="btn-link disabled">VClusterOps access</a></li></ol></nav><div class=td-content><h1>Client access with VClusterOps</h1><header class=article-meta></header><p>In version 24.1.0, Vertica introduces a modernized backend that uses various HTTPS endpoints and communicates with REST APIs. The new backend dramatically reduces the time it takes to set up and execute administrative commands.</p><p>Prior to this version, Vertica managed all server and containerized deployments with Admintools, a traditional CLI that accepts parameters through STDIN and outputs unstructured results to STDOUT, and requires SSH for passwordless access so that it can communicate with all the nodes in the cluster. These features and requirements are not optimal for cloud-native applications.</p><p>This modernized backend replaces admintools with the vcluster package, which abstracts REST API calls into a high-level API. This API maps to administration commands that are available in admintools, such as create database, start vertica, scaling up or down, etc. This package is open source and available on <a href=https://github.com/vertica/vcluster>GitHub</a>.</p><p>The vcluster Go package is integrated into our latest version of the K8s operator. This allows us to deploy Vertica in Kubernetes. In addition to the admin backend change, we have also built some new features into the operator to take advantage of this new architecture.</p><p>The following sections deploy a local Kubernetes cluster to demonstrate some client interactions with the REST API, including how to scale out a subcluster.</p><h2 id=set-up-k8s-cluster>Set up K8s cluster</h2><p>We first need to set up a Kubernetes cluster. There are many ways to set up a Kubernetes cluster on your local machine. For this tutorial, we will use <a href=https://minikube.sigs.k8s.io/docs/>minikube</a>. If you are running Linux, you can copy the commands below to your local machine. For other operating systems, refer to the minikube instructions to understand how to set that up.</p><pre tabindex=0><code>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
</code></pre><p>After the program downloads, you can create the Kubernetes cluster with the following command:</p><pre tabindex=0><code>minikube start
</code></pre><p>To create an EON database, we need a location to store communal access data. For testing purposes, we will store the communal data in the minikube VM itself. By default, all host paths in minikube are owned by root. We will create a directory in one of these host paths and make it world readable so that Vertica can write to it.</p><p>minikube ssh &ndash; &lsquo;sudo mkdir -p /data/vertica && sudo chmod a+w -R /data/vertica&rsquo;</p><h2 id=deploy-the-verticadb-operator>Deploy the VerticaDB operator</h2><p>After setting up minikube, the next step is to deploy the Vertica operator. A key feature in the latest release is that the operator is now cluster-scoped. This means that you can install the operator in a Kubernetes namespace, and it will watch and manage a Vertica database in any other namespace. There are a few ways to deploy the operator: using a Helm chart, operator lifecycle manager, or with a manifest. We will install it with a manifest, with the default settings. If you want more control over the deployment, the Helm chart has a wide range of options that you can configure.</p><p>Here are the commands to run. These commands install custom resource definitions (CRD) that the operator depends on:</p><pre tabindex=0><code>minikube kubectl -- apply --server-side=true --force-conflicts -f https://github.com/vertica/vertica-kubernetes/releases/latest/download/eventtriggers.vertica.com-crd.yaml 
minikube kubectl -- apply --server-side=true --force-conflicts -f https://github.com/vertica/vertica-kubernetes/releases/latest/download/verticaautoscalers.vertica.com-crd.yaml
minikube kubectl -- apply --server-side=true --force-conflicts -f https://github.com/vertica/vertica-kubernetes/releases/latest/download/verticadbs.vertica.com-crd.yaml
</code></pre><p>This command deploys the operator:</p><pre tabindex=0><code>minikube kubectl -- apply -f https://github.com/vertica/vertica-kubernetes/releases/latest/download/operator.yaml 
</code></pre><p>This command waits for the operator to be deployed:</p><pre tabindex=0><code>minikube kubectl -- wait pod --namespace verticadb-operator -l control-plane=controller-manager --for=condition=Ready=True
</code></pre><h2 id=create-a-vertica-cluster>Create a Vertica cluster</h2><p>With the operator deployed, we can now create a Vertica cluster. For the sake of testing, I will create a one-node cluster. This will allow me to scale out the operator without violating the terms of the CE license that it runs.</p><p>Run this command to create a local manifest for the <a href=https://docs.vertica.com/latest/en/containerized/>VerticaDB</a> custom resource (CR).</p><pre tabindex=0><code>cat &lt;&lt; EOF &gt; vdb.yaml
apiVersion: vertica.com/v1
kind: VerticaDB
metadata:
  name: v
  annotations:
    vertica.com/include-uid-in-path: &#34;true&#34;
    vertica.com/run-nma-in-sidecar: &#34;false&#34;
    vertica.com/k-safety: &#34;0&#34; # Allows us to create a 1 node cluster for test purposes
    VERTICA_MEMDEBUG: &#34;2&#34;  # Required if running macOS with an arm based chip
spec:
  image: vertica/vertica-k8s:24.1.0-0-minimal
  communal:
    path: &#34;/communal&#34;
  subclusters:
  - name: sc1
    size: 1
    serviceType: NodePort
  volumes:
  - name: server
    hostPath:
      path: /data/vertica
  volumeMounts:
  - name: server
    mountPath: /communal
EOF
</code></pre><p>If you are familiar with the VerticaDB CR, you will notice that we have upgraded the API version to <code>vertica.com/v1</code>. The previous version was <code>vertica.com/v1beta1</code>. The old version is now deprecated, but you can continue to use it. However, we encourage you to migrate to the new v1 version as soon as possible.</p><p>Run this to create the above CR that will deploy Vertica:</p><pre tabindex=0><code>minikube kubectl -- apply -f vdb.yaml
</code></pre><p>Downloading the image and creating the database will take a few minutes. You can run this command to wait for the process to finish. Depending on your internet connection speed, you may need to repeat this command a few times:</p><pre tabindex=0><code>minikube kubectl -- wait vdb v --for=condition=DBInitialized=True --timeout=10m
</code></pre><p>That’s all there is to it. You have successfully deployed Vertica. Now, let’s take a closer look at some of the features we have added.</p><h2 id=client-access-to-the-rest-api>Client access to the REST API</h2><p>First, let us connect to the database. All connections in Vertica are made through Service objects. By default, we create one for each subcluster. You can retrieve the Service object URLs with the following command:</p><pre tabindex=0><code>minikube service v-sc1

|-----------|-------|-------------------|---------------------------|  
| NAMESPACE | NAME  | TARGET PORT       | URL                       |  
|-----------|-------|-------------------|---------------------------|  
| default   | v-sc1 | vertica/5433      | http://192.168.49.2:30757 | 
|           |       | vertica-http/8443 | http://192.168.49.2:31218 |
|-----------|-------|-------------------|---------------------------|  
[default v-sc1 vertica/5433 vertica-http/8443 http://192.168.49.2:30757 http://192.168.49.2:31218]
</code></pre><p>Note that the URL values for your cluster are different, so replace the URL values in commands for the rest of this tutorial.</p><p>A few ports are exposed by us. 5443 is the traditional Vertica client port. This is where you would connect to send SQL to Vertica through a client like vsql. Run this command to connect and show the Vertica version:</p><pre tabindex=0><code>vsql -h 192.168.49.2 -p 30757 -U dbadmin -c &#34;select version()&#34;
</code></pre><p>The other port is 8443. This is the new HTTPS service that is embedded in Vertica. By default, Vertica generates a production-ready, self-signed certificate. You can replace this with a custom certificate, but we will use the default certificate in this tutorial. As a result, this is an insecure connection and your browser will warn you about it. To use the endpoints, you will need to accept the certificate.</p><h3 id=view-the-swagger-documentation>View the Swagger documentation</h3><p>Open a web browser and go to the following URL. This opens the Swagger documentation to see all of the endpoints exposed by this service:</p><pre tabindex=0><code>https://192.168.49.2:30989/swagger/ui?urls.primaryName=server_docs
</code></pre><h3 id=get-prometheus-metrics>Get Prometheus metrics</h3><p>To see one endpoint in action, I recommend using the /v1/metrics endpoint to view the Prometheus metrics that the server publishes. You can query that endpoint with the following command:</p><pre tabindex=0><code>curl -k -u dbadmin: https://192.168.49.2:30989/v1/metrics
</code></pre><h3 id=scale-out-a-subcluster>Scale out a subcluster</h3><p>To observe REST endpoints in action for admin commands, we will create a new subcluster and then view the operator&rsquo;s log to see the endpoints it called. Run the following command to initiate a scale out operator to a new subcluster named sc2:</p><pre tabindex=0><code>minikube kubectl -- patch vdb/v --type=json --patch=&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/spec/subclusters/-&#34;, &#34;value&#34;: {&#34;name&#34;: &#34;sc2&#34;, &#34;size&#34;: 1, &#34;type&#34;: &#34;secondary&#34;, &#34;serviceType&#34;: &#34;NodePort&#34;}}]&#39; 
minikube kubectl -- wait pod v-sc2-0 --for=condition=Ready=True 
</code></pre><p>To view the HTTP requests that the operator used, you can inspect the logs of the operator.</p><pre tabindex=0><code>minikube kubectl -- logs -n verticadb-operator -l control-plane=controller-manager --tail=-1 | grep &#39;controllers.VerticaDB.AddSubcluster&#39; 
</code></pre><h2 id=tear-down-k8s-cluster>Tear down K8s cluster</h2><p>To clean up the minikube cluster after you are finished with it, run the following command:</p><p>minikube delete</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Open Text Corporation All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=../../js/main.min.b6b5dd18889117d69a57d2b6ed518450be5b0d0206550559698a4233c65c109f.js integrity="sha256-trXdGIiRF9aaV9K27VGEUL5bDQIGVQVZaYpCM8ZcEJ8=" crossorigin=anonymous></script>
<script src=../../js/prism.js></script>
<script src=../../js/tabpane-persist.js></script></body></html>